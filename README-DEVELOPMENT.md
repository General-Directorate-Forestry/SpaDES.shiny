# SpaDES.shiny developer readme.

This readme provides information on developing code in SpaDES.shiny project.

**Website:** [http://SpaDES.PredictiveEcology.org](http://SpaDES.PredictiveEcology.org)

**Wiki:** [https://github.com/PredictiveEcology/SpaDES/wiki](https://github.com/PredictiveEcology/SpaDES/wiki)

## Installation

### Current stable release

[![Build Status](https://travis-ci.org/PredictiveEcology/SpaDES.shiny.svg?branch=master)](https://travis-ci.org/PredictiveEcology/SpaDES.shiny)
[![Appveyor Build status](https://ci.appveyor.com/api/projects/status/2fxqhgk6miv2fytd/branch/master?svg=true)](https://ci.appveyor.com/project/achubaty/spades.shiny/branch/master)
[![Coverage Status](https://coveralls.io/repos/github/PredictiveEcology/SpaDES.shiny/badge.svg?branch=master)](https://coveralls.io/github/PredictiveEcology/SpaDES.shiny?branch=master)
[![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/SpaDES.shiny)](https://cran.r-project.org/package=SpaDES.shiny)
[![Downloads](http://cranlogs.r-pkg.org/badges/grand-total/SpaDES.shiny)](https://cran.r-project.org/package=SpaDES.shiny)

**Install from CRAN:**

```r
install.packages("SpaDES.shiny")
```

**Install from GitHub:**

```r
# install.packages("devtools")
library("devtools")
install_github("PredictiveEcology/SpaDES.shiny", dependencies = TRUE) # stable
```

### Development version (unstable)

[![Build Status](https://travis-ci.org/PredictiveEcology/SpaDES.shiny.svg?branch=development)](https://travis-ci.org/PredictiveEcology/SpaDES.shiny)
[![Appveyor Build status](https://ci.appveyor.com/api/projects/status/2fxqhgk6miv2fytd/branch/development?svg=true)](https://ci.appveyor.com/project/achubaty/spades.shiny/branch/development)
[![Coverage Status](https://coveralls.io/repos/github/PredictiveEcology/SpaDES.shiny/badge.svg?branch=development)](https://coveralls.io/github/PredictiveEcology/SpaDES.shiny?branch=development)

**Install from GitHub:**

```r
#install.packages("devtools")
library("devtools")
install_github("PredictiveEcology/SpaDES.shiny", ref = "development", dependencies = TRUE) # unstable
```

### How to make an app using SpaDES.shiny package

Detailed readme about creating an app is available at [Github README.MD](https://github.com/PredictiveEcology/SpaDES.shiny/blob/master/README.md).

### Developing SpaDES.shiny code

SpaDES.shiny package consists of a set of shiny modules, an app generator and templates. Generator takes application metadata and uses templates to build a standalone application. Modules implement reusable parts of application that can be used to speed up the implementation process.

#### App generator

App generator builds new application in a chosen directory based on application metadata. In the directory there is a `ui.R` and `server.R` created together with all needed files. Generator uses templates (described in next section) to generate the code.

Entry point of generator is `newApp` function. Application metadata is passed to other functions to build different parts of the app.

Generated application is a `shinydashboard`, where each item is a shiny module.

#### App templates

Application templates are located `inst/templates`. Any static parts of application that are generated by the generator should be put here. Generator uses [https://cran.r-project.org/web/packages/whisker/index.html](whisker) package to generate files from templates. In order to add a new ui/server component, create a new file in `inst/templates/` directory with the `.template` extension.

Inside the template write code that you'd like to have generated. Put variables in Mustache `{{variable}}`. By default whisker applies html escaping on the generated text. To prevent this use `{{{variable}}}` (triple) in stead of `{{variable}}`.

#### Shiny modules

Shiny modules in SpaDES.shiny are generic components that can be used to bootstrap the application. The module should have a generic purpose and the main aim of developer should be to make this module reusable in different applications.

When building a new shiny module try to extract as much code as possible to separate modules that can be reused in other use cases. For example if you are building a shiny module that consists of a table, plot and a slider divide it into three modules each representing separate logic that can be reusable - a table view of a data.frame, a plot and a slider. First always check if there already exists a module that does the job.

Take a look at `rastersOverTime` module. The aim of this module is to display a map with rasters that change over time. We want to be able to also change underlying polygons that are displayed and show histogram of raster values.

We can divide this module into smaller independent components. `rastersOverTime` module actually consists of a:

```
- map
- slider that allows user to choose raster to display
- slider that allows user to choose polygons to display
- raster updater that draws a chosen raster on a map
- polygon updater that draws chosen set of polygons on a map
- summary popup that shows pop ups on map for selected polygons and raster
- histogram for a raster
```

This division gives us 7 independent generic components (actually 6 components - slider is used twice) that can be used in any combination.

In the end your code may look as follows:

```r
rasterIndexValue <- callModule(slider, "rastersSlider")
polygonIndexValue <- callModule(slider, "polygonsSlider")
...
callModule(tilesUpdater, "tilesUpdater", mapProxy, urlTemplate, session$ns("tiles"),
           addTilesParameters = addTilesParameters, addLayersControlParameters = NULL)
callModule(summaryPopups, "popups", mapProxy, click, raster, polygons)
callModule(polygonsUpdater, "polygonsUpdater", mapProxy, polygons, weight = 0.2)
callModule(histogramForRaster, "histogram", sampledRaster, histogramBreaks = breaks,
           scale = rasterScale, addAxisParams = addAxisParams,
           width = 1, space = 0)
```

What is more - if someone wants to create a map with raster selection and popups - he can just take a map, slider, raster updater and summary popup. What's more user can decide to implement different way of selecting the raster - he'll just use another module instead of the slider.
